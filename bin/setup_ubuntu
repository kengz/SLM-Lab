#!/bin/bash --login
# This script sets up SLM Lab for Linux Ubuntu

# Fail on the first error; killable by SIGINT
set -e
trap "exit" INT

echo "--- Installing system dependencies ---"
apt-get update && \
  apt-get install -y build-essential \
  curl git python3-dev cmake swig \
  libsdl2-dev libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1 xvfb && \
  rm -rf /var/lib/apt/lists/*

echo "--- Installing uv ---"
if which uv >/dev/null; then
  echo "uv is already installed"
else
  curl -LsSf https://astral.sh/uv/install.sh | sh
  export PATH="$HOME/.local/bin:$PATH"
fi

echo "--- Installing Python dependencies with uv ---"
# uv will automatically create virtual environment and install dependencies
uv sync

export PATH="$HOME/.local/bin:$PATH"
echo "--- Lab setup complete ---"
