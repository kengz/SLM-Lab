#!/bin/bash --login
# This script sets up SLM Lab for Linux Ubuntu

# Fail on the first error; killable by SIGINT
set -e
trap "exit" INT

echo "--- Installing system dependencies ---"
pacman -Suy
pacman -Sy --needed git cmake gcc base-devel swig
pacman -Sy --needed xorg-server-xvfb sdl2 glibc libxext libsm libxrender

echo "--- Installing uv ---"
if which uv >/dev/null; then
  echo "uv is already installed"
else
  curl -LsSf https://astral.sh/uv/install.sh | sh
  export PATH="$HOME/.local/bin:$PATH"
fi

echo "--- Installing Python dependencies with uv ---"
# uv will automatically create virtual environment and install dependencies
uv sync

export PATH="$HOME/.local/bin:$PATH"
echo "--- Lab setup complete ---"
