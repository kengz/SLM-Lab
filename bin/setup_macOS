#!/bin/bash --login
# This script sets up SLM Lab for macOS

# Fail on the first error; killable by SIGINT
set -e
trap "exit" INT

echo "--- Installing brew ---"
if which brew >/dev/null; then
  echo "Brew is already installed"
else
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

echo "--- Installing brew system dependencies ---"
hb_list=(cmake sdl2 swig)
for item in "${hb_list[@]}"; do
  echo "Installing ${item}"
  brew info "${item}" | grep --quiet "Not installed" && brew install "${item}"
done

echo "--- Installing uv ---"
if which uv >/dev/null; then
  echo "uv is already installed"
else
  curl -LsSf https://astral.sh/uv/install.sh | sh
  export PATH="$HOME/.local/bin:$PATH"
fi

echo "--- Installing Python dependencies with uv ---"
# uv will automatically create virtual environment and install dependencies
uv sync

export PATH="$HOME/.local/bin:$PATH"
echo "--- Lab setup complete ---"
