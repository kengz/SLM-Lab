type: task
name: train

python: 3.12

env:
  - SPEC_FILE
  - SPEC_NAME
  - LAB_MODE=train
  - SET_ARGS

commands:
  # Install minimal dependencies for OpenCV and RL environments
  - apt-get update && apt-get install -y swig libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1
  # Change to project directory and install Python dependencies
  - cd /workflow && uv sync
  # Run SLM Lab training
  - cd /workflow && uv run slm-lab ${SET_ARGS} ${SPEC_FILE} ${SPEC_NAME} ${LAB_MODE}

# mount to persist
# volumes:
#   - cache-volume:/root/.cache
#   - data-volume:/workflow/data

resources:
  # cpu: 4      # Uncomment to specify CPU cores
  gpu: L4 # Options: L4, A10G, A100, H100, etc.

# backends: [runpod]  # Options: runpod, vast, lambda, aws, gcp, azure
