type: task
name: slm-lab

python: 3.12

# Mount local files to /workflow
files:
  - ..:/workflow

env:
  - HF_TOKEN
  - HF_REPO
  - SPEC_FILE
  - SPEC_NAME
  - LAB_MODE
  - SPEC_VARS  # --set overrides, e.g. "-s env=ALE/Breakout-v5"

commands:
  - apt-get update && apt-get install -y swig libgl1-mesa-glx libglib2.0-0 libsm6 libxext6 libxrender-dev libgomp1
  - cd /workflow && uv sync
  - cd /workflow && uv run slm-lab run ${SPEC_VARS} ${SPEC_FILE} ${SPEC_NAME} ${LAB_MODE} --upload-hf

# GPU train: any GPU up to 16GB for MLP-based RL ($0.13-0.20/hr range)
resources:
  gpu: ..16GB
  cpu: 4..
  memory: 14GB..

spot_policy: on-demand
max_duration: 6h
max_price: 0.20
# backends: [runpod, datacrunch]  # commented out for wider availability
retry:
  on_events: [no-capacity]
  duration: 1h
